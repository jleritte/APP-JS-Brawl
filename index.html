<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Brawl</title>
  <link rel="stylesheet" href="./css/Brawl.css">
  <link rel="icon" href="./img/favicon.ico">
</head>
<body>
  <div class="menu">
    <select class="who icon">
      <option class="icon Bennett" value="Bennett"></option>
      <option class="icon Chris" value="Chris"></option>
      <option class="icon Darwin" value="Darwin"></option>
      <option class="icon Hale" value="Hale"></option>
      <option class="icon Morgan" value="Morgan"></option>
      <option class="icon Pearl" value="Pearl"></option>
    </select>
    <div class="buttonBox">
      <input type="button" onclick="who.dispatchEvent(change)" value="Shuffle">
    </div>
    <div class="buttonBox">
      <input type="button" onclick="clearDeck()" value="Clear">
    </div>
  </div>
  <div class="grid">
    <div class="contain">
      <div>
        <div class="front"></div>
        <div class="back"></div>
      </div>
    </div>
    <div class="contain">
      <div>
        <div class="front"></div>
        <div class="back"></div>
      </div>
    </div>
    <div class="contain">
      <div>
        <div class="front"></div>
        <div class="back"></div>
      </div>
    </div>
    <div class="contain">
      <div>
        <div class="front"></div>
        <div class="back"></div>
      </div>
    </div>
    <div class="contain">
      <div>
        <div class="front"></div>
        <div class="back"></div>
      </div>
    </div>
    <div class="contain">
      <div>
        <div class="front"></div>
        <div class="back"></div>
      </div>
    </div>
    <div class="contain">
      <div>
        <div class="front"></div>
        <div class="back"></div>
      </div>
    </div>
    <div class="contain">
      <div>
        <div class="front"></div>
        <div class="back"></div>
      </div>
    </div>
    <div class="contain">
      <div>
        <div class="front"></div>
        <div class="back"></div>
      </div>
    </div>
    <div class="contain">
      <div>
        <div class="front"></div>
        <div class="back"></div>
      </div>
    </div>
    <div class="contain">
      <div>
        <div class="front"></div>
        <div class="back"></div>
      </div>
    </div>
    <div class="contain">
      <div>
        <div class="front"></div>
        <div class="back"></div>
      </div>
    </div>
    <div class="contain">
      <div>
        <div class="front"></div>
        <div class="back"></div>
      </div>
    </div>
    <div class="contain">
      <div>
        <div class="front"></div>
        <div class="back"></div>
      </div>
    </div>
    <div class="contain">
      <div>
        <div class="front"></div>
        <div class="back"></div>
      </div>
    </div>
    <div class="contain">
      <div>
        <div class="front"></div>
        <div class="back"></div>
      </div>
    </div>
    <div class="contain">
      <div>
        <div class="front"></div>
        <div class="back"></div>
      </div>
    </div>
    <div class="contain">
      <div>
        <div class="front"></div>
        <div class="back"></div>
      </div>
    </div>
    <div class="contain">
      <div>
        <div class="front"></div>
        <div class="back"></div>
      </div>
    </div>
    <div class="contain">
      <div>
        <div class="front"></div>
        <div class="back"></div>
      </div>
    </div>
    <div class="contain">
      <div>
        <div class="front"></div>
        <div class="back"></div>
      </div>
    </div>
    <div class="contain">
      <div>
        <div class="front"></div>
        <div class="back"></div>
      </div>
    </div>
    <div class="contain">
      <div>
        <div class="front"></div>
        <div class="back"></div>
      </div>
    </div>
    <div class="contain">
      <div>
        <div class="front"></div>
        <div class="back"></div>
      </div>
    </div>
    <div class="contain">
      <div>
        <div class="front"></div>
        <div class="back"></div>
      </div>
    </div>
    <div class="contain">
      <div>
        <div class="front"></div>
        <div class="back"></div>
      </div>
    </div>
    <div class="contain">
      <div>
        <div class="front"></div>
        <div class="back"></div>
      </div>
    </div>
    <div class="contain">
      <div>
        <div class="front"></div>
        <div class="back"></div>
      </div>
    </div>
    <div class="contain">
      <div>
        <div class="front"></div>
        <div class="back"></div>
      </div>
    </div>
    <div class="contain">
      <div>
        <div class="front"></div>
        <div class="back"></div>
      </div>
    </div>
    <div class="contain">
      <div>
        <div class="front"></div>
        <div class="back"></div>
      </div>
    </div>
    <div class="contain">
      <div>
        <div class="front"></div>
        <div class="back"></div>
      </div>
    </div>
    <div class="contain">
      <div>
        <div class="front"></div>
        <div class="back"></div>
      </div>
    </div>
    <div class="contain">
      <div>
        <div class="front"></div>
        <div class="back"></div>
      </div>
    </div>
    <div class="contain">
      <div>
        <div class="front"></div>
        <div class="back"></div>
      </div>
    </div>
  </div>
  <span class="Bennett" style="visibility:hidden"><span class="back"></span></span>
  <span class="Chris" style="visibility:hidden"><span class="back"></span></span>
  <span class="Darwin" style="visibility:hidden"><span class="back"></span></span>
  <span class="Hale" style="visibility:hidden"><span class="back"></span></span>
  <span class="Morgan" style="visibility:hidden"><span class="back"></span></span>
  <span class="Pearl" style="visibility:hidden"><span class="back"></span></span>
  <!--script src="./js/Brawl.js"></script-->
  <script>
    var BENNETT = [7,8,0,1,3,0,1,4,0,1,6,1,3],
        CHRIS =   [4,7,0,2,5,0,2,8,0,2,2,0,3],
        DARWIN =  [3,4,1,3,4,0,1,8,1,3,1,3,3],
        HALE =    [6,5,1,0,8,1,1,4,1,1,4,0,3],
        MORGAN =  [5,8,0,4,6,0,2,2,0,1,4,0,3],
        PEARL =   [5,7,1,1,7,1,1,1,0,1,5,2,3];
    var CARDNAME = ['base', 'hitB', 'hit2B', 'blockB',
                    'hitG', 'hit2G', 'blockG', 'hitR',
                    'hit2R', 'blockR', 'clear', 'press', 'freeze'];
    var DECKSIZE = 35;
    var grid = document.getElementsByClassName('grid')[0],
        who = document.getElementsByClassName('who')[0],
        change = new Event('change'),
        hover = new Event('hover'),
        click = new Event('click');
    who.addEventListener('change',loadDeck);
    who.dispatchEvent(change);
    function loadDeck(e){
      var who = e.target.value;
      e.target.className = 'who icon '+who;
      Array.prototype.forEach.call(window.who.children, function(option,i) {
        if(option.className === 'icon '+who){
          option.style.display = 'none';
        } else if (option.style.display == 'none') {
          option.style.display = 'block';
        }
      });
      console.log(who);
      switch(who) {
        case 'Bennett':  show(who,BENNETT);break;
        case 'Chris':    show(who,CHRIS);break;
        case 'Darwin':   show(who,DARWIN);break;
        case 'Hale':     show(who,HALE);break;
        case 'Morgan':   show(who,MORGAN);break;
        case 'Pearl':    show(who,PEARL);break;
        default:         alert('Not a Person!');clearDeck();
      }
    }
    function buildLabels(deck) {
      var i,j, ct=0, bd=[];
      for(i = 0; i < 13; i++){
        for(j = 0; j < deck[i]; j++){
          var front = grid.children[ct].firstElementChild.firstElementChild;
          bd[ct] = CARDNAME[i];
          ct++;
        }
      }
      return bd;
    }
    function _shuffle(deck) {
      for(var i = 31; i > 0; i--) {
        var rand = Math.floor(Math.random() * (i + 1));
        if(rand > 0) {
          temp = deck[i];
          deck[i] = deck[rand];
          deck[rand] = temp;
        }
      }
      return deck;
    }
    function show(name,deck) {
      var deck = buildLabels(deck), ct = 0;
      deck = _shuffle(deck);
      Array.prototype.forEach.call(grid.children, function(contain,i) {
        var card = contain.firstElementChild, lt;
        if (ct < 7){
          lt = 0;
        } else if (ct < 14) {
          lt = 1;
        } else if (ct < 21) {
          lt = 2;
        } else if (ct < 28) {
          lt = 3;
        } else if (ct < 35) {
          lt = 4;
        }
        contain.style.zIndex = 170-i*5;
        contain.style.left = (lt*5+105)+'px';
        contain.style.top = 0;
        card.style.opacity = 1;
        card.style.transform = '';
        card.className = 'deck card '+name;
        card.addEventListener('click',flip);
        card.firstElementChild.className = 'front '+deck[i];
        ct++;
      });
      grid.children[0].firstElementChild.dispatchEvent(click);
    }
    function clearDeck(){
      Array.prototype.forEach.call(grid.children, function(contain,i) {
        contain.firstElementChild.style.opacity = 0;
      });
    }
    function flip (e) {
      e = e.target;
      var card = e.className === 'back'?e.parentElement:e,
          contain = card.parentElement,
          left = contain.style.left.replace('px',''),
          zrotate = Math.floor(Math.random() *360);//* 10 + 90);
      card.style.transform = 'rotateY(180deg)';//' rotateZ(' + zrotate + 'deg)';
      card.className = card.className.replace('deck','');
      contain.style.left = 300+'px';
      contain.style.zIndex = 0;
      card.removeEventListener('click',flip);
    }
    function div(clss){
      var rtrn = document.createElement('div');
      rtrn.className = clss;
      return rtrn;
    }
  </script>
</body>
</html>